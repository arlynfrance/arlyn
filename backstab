local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local lp = Players.LocalPlayer

-- Backstab range variable
local backstabRange = 20 -- default, slider will adjust this

-- Load ESP Library
local ESPLibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/Exunys/Exunys-ESP/main/src/ESP.lua"))()
ESPLibrary:Toggle(false)

-- GUI Setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BackstabToggleGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = lp:WaitForChild("PlayerGui")

-- Drag frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 200, 0, 150)
mainFrame.Position = UDim2.new(0.5, -100, 0.5, -75)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderColor3 = Color3.fromRGB(100, 100, 100)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

-- ESP Toggle Button
local espButton = Instance.new("TextButton")
espButton.Size = UDim2.new(1, -20, 0, 30)
espButton.Position = UDim2.new(0, 10, 0, 10)
espButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
espButton.BorderColor3 = Color3.fromRGB(100, 100, 100)
espButton.TextColor3 = Color3.fromRGB(255, 255, 255)
espButton.Text = "ESP: OFF"
espButton.Parent = mainFrame

local espEnabled = false
espButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    ESPLibrary:Toggle(espEnabled)
    espButton.Text = espEnabled and "ESP: ON" or "ESP: OFF"
    espButton.BackgroundColor3 = espEnabled and Color3.fromRGB(100, 100, 100) or Color3.fromRGB(40, 40, 40)
end)

-- Slider Frame
local sliderFrame = Instance.new("Frame")
sliderFrame.Size = UDim2.new(1, -20, 0, 30)
sliderFrame.Position = UDim2.new(0, 10, 0, 50)
sliderFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
sliderFrame.BorderColor3 = Color3.fromRGB(100, 100, 100)
sliderFrame.Parent = mainFrame

local sliderButton = Instance.new("TextButton")
sliderButton.Size = UDim2.new(0, 10, 1, 0)
sliderButton.Position = UDim2.new(0, 0, 0, 0)
sliderButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
sliderButton.BorderSizePixel = 0
sliderButton.Text = ""
sliderButton.Parent = sliderFrame

local uis = game:GetService("UserInputService")
local draggingSlider = false

sliderButton.MouseButton1Down:Connect(function()
    draggingSlider = true
end)

uis.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingSlider = false
    end
end)

RunService.RenderStepped:Connect(function()
    if draggingSlider then
        local mouseX = uis:GetMouseLocation().X
        local sliderStart = sliderFrame.AbsolutePosition.X
        local sliderEnd = sliderStart + sliderFrame.AbsoluteSize.X
        local sliderSize = sliderFrame.AbsoluteSize.X

        local position = math.clamp(mouseX - sliderStart, 0, sliderSize)
        sliderButton.Position = UDim2.new(0, position, 0, 0)

        -- Convert slider position to range (5â€“50 studs)
        backstabRange = math.floor(5 + (position / sliderSize) * (50 - 5))
    end
end)

-- Backstab logic
local function tweenBackstab(target)
    if not target or not target:FindFirstChild("HumanoidRootPart") then return end
    local char = lp.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end

    local targetPos = target.HumanoidRootPart.Position
    local myPos = char.HumanoidRootPart.Position
    local dist = (myPos - targetPos).Magnitude

    if dist <= backstabRange then
        local tween = TweenService:Create(
            char.HumanoidRootPart,
            TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {CFrame = CFrame.new(targetPos - target.HumanoidRootPart.CFrame.LookVector * 2)}
        )
        tween:Play()
    end
end

RunService.RenderStepped:Connect(function()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= lp and player.Character and player.Character:FindFirstChild("Humanoid") then
            if player.Character.Humanoid.Health > 0 then
                tweenBackstab(player.Character)
            end
        end
    end
end)

-- Toggle GUI with RightShift
uis.InputBegan:Connect(function(input, gpe)
    if not gpe and input.KeyCode == Enum.KeyCode.RightShift then
        screenGui.Enabled = not screenGui.Enabled
    end
end)
